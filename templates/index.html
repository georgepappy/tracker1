<!DOCTYPE html>
<html lang="en">
<head>
    <title>US COVID-19 Dashboard</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> 

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

</head>
<body>

<!-- This drop-down menu structure is pattered after this tutorial from Pretty Printed:
                        https://www.youtube.com/watch?v=I2dJuNwlIH0 -->

    <div id="main-container">
      <h1>US COVID-19 Dashboard</h1>

    <form method="POST">
        {{ form.csrf_token }}
        {{ form.state }}
        {{ form.county }}
    <input type="submit">
    </form>

    <br>

    <a href="{{ url_for('index') }}"><button>RESET PAGE</button></a>

    <br><br>

    {% if result %}
       <!-- <h2>Statewide Result</h2>

       <h4>{{result[0]}}</h4>

       <br><br>

       <h2>Countywide Result</h2>

       <h4>{{result[1]}}</h4>

       <br><br> -->

       <!-- <h2>{{tbl|safe}}</h2> -->

       <!--Table formatting & style ideas based on 
           https://dev.to/dcodeyt/creating-beautiful-html-tables-with-css-428l  -->

       <table border="5px" bordercolor="#8707B0">
       <caption style="caption-side:bottom">
           <h3>(In 2017-18, the overall U.S. Flu Fatality Rate was 0.14%; in 2018-19 it was 0.10%)</h3>
       </caption>
          <tr>
            <td bgcolor=#69F5C9 style="text-align:center">
                {% if result[0]|length == 1 -%}
                    <h2>   {{result[0][0]}}</h2>
                {% else -%}
                    <h2>   {{result[0][0]}} (Since Pandemic Start)</h2>
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th>Total Cases</th>
                                <th>Total Deaths</th>
                                <th>Cases per 100k</th>
                                <th>Fatality Rate (%)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{result[0][1]}}</td>
                                <td>{{result[0][2]}}</td>
                                <td>{{result[0][3]}}</td>
                                <td>{{result[0][4]}}%</td>
                            </tr>
                        </tbody>
                    </table>
                {% endif %}
            </td>
            <td bgcolor=#69F5C9 style="text-align:center">
                {% if result[1]|length == 1 -%}
                    <h2>   {{result[1][0]}}</h2>
                {% else -%}
                    <h2>   {{result[1][0]}} (Past 7 Days)</h2>
                    <table class="styled-table">
                         <thead>
                             <tr>
                                 <th>Total Cases</th>
                                 <th>Total Deaths</th>
                                 <th>Cases per 100k</th>
                                 <th>Fatality Rate (%)</th>
                             </tr>
                         </thead>
                         <tbody>
                             <tr>
                                 <td>{{result[1][1]}}</td>
                                 <td>{{result[1][2]}}</td>
                                 <td>{{result[1][3]}}</td>
                                 <td>{{result[1][4]}}%</td>
                             </tr>
                         </tbody>
                     </table>
                {% endif %}
            </td>
           </tr>
        </table>


    {% endif %}

    </div>


    <div id="second-container">
        
    {% if result %}
       <table border="5px" bordercolor="#8707B0">
       <caption style="caption-side:bottom">
           <h3>(In 2017-18, the overall U.S. Flu Fatality Rate was 0.14%; in 2018-19 it was 0.10%)</h3>
       </caption>
          <tr>
            <td bgcolor=#69F5C9 style="text-align:center">
                {% if result[2]|length == 1 -%}
                    <h2>   {{result[2][0]}}</h2>
                {% else -%}
                    <h2>   {{result[2][0]}} County (Since Pandemic Start)</h2>
                    <table class="styled-table">
                        <thead>
                            <tr>
                                <th>Total Cases</th>
                                <th>Total Deaths</th>
                                <th>Cases per 100k</th>
                                <th>Fatality Rate (%)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{result[2][2]}}</td>
                                <td>{{result[2][3]}}</td>
                                <td>{{result[2][4]}}</td>
                                <td>{{result[2][5]}}%</td>
                            </tr>
                        </tbody>
                    </table>
                {% endif %}
            </td>
            <td bgcolor=#69F5C9 style="text-align:center">
                {% if result[3]|length == 1 -%}
                    <h2>   {{result[3][0]}}</h2>
                {% else -%}
                    <h2>   {{result[3][0]}} County (Past 7 Days)</h2>
                    <table class="styled-table">
                         <thead>
                             <tr>
                                 <th>Total Cases</th>
                                 <th>Total Deaths</th>
                                 <th>Cases per 100k</th>
                                 <th>Fatality Rate (%)</th>
                             </tr>
                         </thead>
                         <tbody>
                             <tr>
                                 <td>{{result[3][2]}}</td>
                                 <td>{{result[3][3]}}</td>
                                 <td>{{result[3][4]}}</td>
                                 <td>{{result[3][5]}}%</td>
                             </tr>
                         </tbody>
                     </table>
                {% endif %}
            </td>
           </tr>
        </table>


    {% endif %}

    </div>
     

    <script>
        var state_select = document.getElementById("state");
        var county_select = document.getElementById("county");

        state_select.onchange = function()  {
             
            state = state_select.value;
            
            fetch('/county/' + state).then(function(response) {

                response.json().then(function(data) {
                    var optionHTML = '';

                    for (var county of data.counties) {
                        optionHTML += '<option value="' + county.id + '">' + county.name + '</option>';
                    }

                    county_select.innerHTML = optionHTML;
                })
                
            });
        }
    </script>





</body>
</html>